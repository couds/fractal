# fractal: A Plug&Play Microfrontend Framework

fractal is a microfrontend framework designed to make it simple to create and use React components as microfrontends in any web application, even in non-React environments. The framework is divided into three packages:

1. `@couds/fractal-core`: The core library that provides a function to register a React component as a microfrontend, making it accessible through a special object in the window.
2. `@couds/fractal-cli`: A command-line tool for building and watching (in development mode) changes, generating the JavaScript artifacts using webpack behind the scenes.
3. `@couds/fractal-react`: A React component allowing you to utilize a microfrontend generated by `@couds/fractal-core` within a React component and pass any props.

The `@couds/fractal-cli` creates two JavaScript artifacts:

1. `[your-microfrontend].js`: Includes all packages used in the microfrontend, such as React, ReactDOM, and others.
2. `[your-microfrontend]-frameworkless.js`: Excludes React, ReactDOM, and other libraries specified in the package configuration, reducing the final JavaScript size and enabling better reusability between microfrontends and host applications.

The build process also generates a CSS file, `[your-microfrontend].css`, containing the styles used in your microfrontend.

## Creating a New Microfrontend

Creating a microfrontend with any React component involves the following steps:

1. Create a file in your project directory with the following contents:

```js
import fractal from '@couds/fractal-core';
import MyComponent from 'YOUR-COMPONENT-FILE';

fractal(MyComponent, { name: '[your-microfrontend-name]' });
```

This file imports and registers the `MyComponent` React component as a new microfrontend with the specified name using the `fractal` function from the `@couds/fractal-core` package.

2. **(Optional)** If you want to add server-side rendering (SSR) to your microfrontend, create another file to serve as your server-side entry point:

```js
import fractal from '@couds/fractal-core/server';
import Component from 'YOUR-COMPONENT-FILE';

fractal(Component);
```

3. Create a `.fractalrc.json` configuration file for your microfrontend. You can use the `npx @couds/fractal-cli init` command to help with the setup. The configuration should look like this:

```json
{
  "entry": {
    "client": "./src/client.js",
    "server": "./src/server.js" // if SSR is enabled
  },
  "output": "./dist",
  "shared": {
    "lodash": "_" // any shared library you'd like to exclude from the final bundle
  }
}
```

This file specifies your microfrontend's entry point, output directory, and shared dependencies (such as Lodash in this example).

4. Add a `build` and `dev` script to your `package.json` file, invoking the fractal CLI:

```json
{
  "name": "my-first-microfrontend",
  "scripts": {
    "build": "fractal-cli build",
    "dev": "fractal-cli watch",
  }
}
```

These scripts build your microfrontend using the configuration specified in your `.fractalrc.json` file.

5. Execute `npm run build` to build your microfrontend.

The build process will generate two files in the `dist/client` directory:

1. `my-first-microfrontend.js`: This file contains your microfrontend code and any shared dependencies specified in your `.fractalrc.json` file.
2. `my-first-microfrontend-frameworkless.js`: This file contains only your microfrontend code, without any shared dependencies.

If SSR is enabled, it will also generate a `dist/server/main.js` file, which will be an Express application listening on port 3000. You can change the port by setting a PORT environment variable before starting the server.

## Development

To run the CLI in watch mode, execute `npm run dev`. This will expose `http://localhost:3000` and render the microfrontend. Query parameters will be passed as props to the microfrontend.

In summary, fractal is a user-friendly microfrontend framework that simplifies the process of creating and using React components as microfrontends in any web application. It provides a clear structure for your project, making it easy to understand and maintain. By following the steps outlined in this guide, you can quickly create a new microfrontend and start developing right away.

## How to consume a fractal Microfrontend

For React applications we provide a component within the package `@couds/fractal-react` to help you integrate an fractal microfrontend eadyly like this

```jsx
import React from 'react';
import fractal from '@couds/fractal-react';

const App = () => {
  return (
    <fractal
      _setup={{
        script: 'microfrontend-remote-url.js',
        markup: 'html if you want to server side render this component'
        mount: true, // true if you want to mount the MF inside your react tree, usefull to share context
      }}
      prop="1" // You can pass props to the microfrontend as you would do any other component (this will be pass as props to the React MF)
    />
  )
};
```
## Extend Webpack configuration

You can add a webpack field on your configuration file (only on `.js` config) that will get the current webpack configuration, you will need to return the new webpack configuration (you can mutate it like on `next.config.js`)

You could add bundle analyzer to your microfrontend and a alias to src like this

```js
const path = require('path');
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;

module.exports = {
  "entry": {
    "client": "./src/entry.js"
  },
  "output": "./dist",
  webpack: (config) => {
    config.plugins = config.plugins.concat([
      new BundleAnalyzerPlugin({
        analyzerMode: 'static'
      }),
    ])
    config.resolve.alias = {
      ...config.resolve.alias,
      '@': path.resolve(__dirname, './src'),
    };
    return config;
  }
}
```